<!DOCTYPE html>  <html> <head>   <title>app.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               app.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Tudoo version 1 <br />
- A simple todo application made in Coffeescript <br />
- Works on Safari, Chrome, Firefox and in iOS and newer Andriod systems</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>We create a new TodoWidget, and Initialize it</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">todo_widget = </span><span class="k">new</span> <span class="nx">TodoWidget</span>
  <span class="nx">todo_widget</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The TodoWidget is the class that controls the whole todo app</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">TodoWidget</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The init function handles the loading of the application.
It asks the TodoData class to load the data from localstorage, 
and reads and render the templates from the index.html page.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">init: </span><span class="o">-&gt;</span>
    <span class="vi">@data = </span><span class="k">new</span> <span class="nx">TodoData</span> <span class="c1"># we create a new data object</span>
    <span class="vi">@template = </span><span class="nx">load_template</span><span class="p">(</span><span class="s2">&quot;todo_widget&quot;</span><span class="p">)</span> <span class="c1"># we read the main template</span>
    <span class="vi">@item_template = </span><span class="nx">load_template</span><span class="p">(</span><span class="s2">&quot;todo_item&quot;</span><span class="p">)</span> <span class="c1"># we read the item template</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>we ask the render method to render our application</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@render</span><span class="p">()</span> 

    <span class="nx">@init_item_actions</span><span class="p">()</span>
    <span class="nx">@init_form</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>This method deleted a item, and removes it form the data</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">delete_item: </span><span class="nf">(label_item) -&gt;</span>
    <span class="nv">item = </span><span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">label_item</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">))</span>
    <span class="nv">index = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#items li&#39;</span><span class="p">).</span><span class="nx">index</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="c1"># we get the index of the item in the list</span>
    <span class="nx">@data</span><span class="p">.</span><span class="nx">delete_item</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span> <span class="c1"># we ask the data to delete the item</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">item</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span> <span class="c1"># we remove the item from the UI</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>This method binds the actions we can do with the item</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">init_item_actions: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>We create some variables to hold the item deletion timeouts</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@timeout_delete = </span><span class="mi">0</span>
    <span class="vi">@timeout_strike = </span><span class="mi">0</span> 
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#items li&quot;</span><span class="p">).</span><span class="nx">disableSelection</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>We register the events we can do on the label. This registers both the
mouse events and the touch events</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#items li label&quot;</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s2">&quot;mousedown&quot;</span><span class="p">,</span> <span class="nx">@item_down</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">live</span><span class="p">(</span><span class="s2">&quot;mouseup&quot;</span><span class="p">,</span> <span class="nx">@item_up</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">live</span><span class="p">(</span><span class="s2">&quot;touchstart&quot;</span><span class="p">,</span> <span class="nx">@item_down</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">live</span><span class="p">(</span><span class="s2">&quot;touchend&quot;</span><span class="p">,</span> <span class="nx">@item_up</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>This method is fired, when we press down on an item</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">item_down: </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>We notify the user that they are deleting</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@timeout_strike = </span><span class="nx">setTimeout</span> <span class="o">=&gt;</span> 
      <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;deleting&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="mi">500</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>We are deleting the item, after one secound</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@timeout_delete = </span><span class="nx">setTimeout</span> <span class="o">=&gt;</span> 
      <span class="nx">@delete_item</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span>
    <span class="p">,</span> <span class="mi">1000</span>
    <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>This method is fired when we release our hold on an item</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">item_up: </span><span class="nf">(event) -&gt;</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">@timeout_delete</span><span class="p">)</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">@timeout_strike</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;deleting&quot;</span><span class="p">)</span>
    <span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>This method binds our actions to our new item form</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">init_form: </span><span class="o">-&gt;</span>
    <span class="vi">@add_item_submit = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#add_item_submit&quot;</span><span class="p">)</span>
    <span class="vi">@add_item_text = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#add_item_text&quot;</span><span class="p">)</span>
    <span class="vi">@add_item_form = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#add_item_form&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>We add a item, when the form is submitted</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@add_item_form</span><span class="p">.</span><span class="nx">submit</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
      <span class="nx">@add_item</span> <span class="nx">@add_item_text</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
      <span class="nx">@reset_form</span><span class="p">()</span>
      <span class="kc">false</span>

  <span class="nv">render: </span><span class="o">-&gt;</span>
    <span class="nx">set_screen</span><span class="p">(</span><span class="nx">@template</span><span class="p">(</span><span class="nx">@data</span><span class="p">.</span><span class="nx">load</span><span class="p">()))</span>

  <span class="nv">reset_form: </span><span class="o">-&gt;</span>
    <span class="nx">@add_item_text</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nx">@add_item_text</span><span class="p">.</span><span class="nx">focus</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>This method adds a new item to the data, and to the UI</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">add_item: </span><span class="nf">(text) -&gt;</span>
    <span class="nv">item = </span><span class="nx">@data</span><span class="p">.</span><span class="nx">add_item</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#items&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">@item_template</span><span class="p">({</span><span class="nv">item: </span><span class="nx">item</span><span class="p">}))</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#items li&quot;</span><span class="p">).</span><span class="nx">disableSelection</span><span class="p">()</span>

<span class="k">class</span> <span class="nx">TodoData</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>On load, we will read from localStorage. If no data is found, we will
create some simple sample data</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">load: </span><span class="o">-&gt;</span>
    <span class="vi">@local_data = </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;todo&quot;</span><span class="p">);</span>
    <span class="vi">@data = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">@local_data</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@local_data</span><span class="p">;</span>
    <span class="vi">@data = </span><span class="p">[{</span><span class="nv">text: </span><span class="s2">&quot;Hold me to delete&quot;</span><span class="p">}]</span> <span class="nx">unless</span> <span class="nx">@data</span>
    <span class="nv">items: </span><span class="nx">@data</span>
  </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>We add a item to the array, and store it in localStorage</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">add_item: </span><span class="nf">(text)-&gt;</span>
    <span class="nv">item = </span><span class="p">{</span><span class="nv">text: </span><span class="nx">text</span><span class="p">}</span>
    <span class="nx">@data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
    <span class="nx">@store</span><span class="p">()</span>
    <span class="nx">item</span>
  <span class="nv">delete_item: </span><span class="nf">(index) -&gt;</span>
    <span class="nx">@data</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> 
    <span class="nx">@store</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>We store the array in localStorage. We call JSON.stringify to be able to 
store complex objects in localstorage.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">store: </span><span class="o">-&gt;</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;todo&quot;</span><span class="p">,</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">@data</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Utility functions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">load_template = </span><span class="nf">(name) -&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{name}&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">())</span>

<span class="nv">set_screen = </span><span class="nf">(html) -&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#screen&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>    

<span class="nv">log = </span><span class="nf">(message) -&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">message</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>We use this method to disable selections on mobile devises,
so we can use the delete action on a long hold</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{</span>
  <span class="nv">disableSelection: </span><span class="o">-&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">each</span> <span class="o">-&gt;</span>
      <span class="k">this</span><span class="p">.</span><span class="nv">onselectstart = </span><span class="o">-&gt;</span>
        <span class="k">return</span> <span class="kc">false</span>

      <span class="k">this</span><span class="p">.</span><span class="nv">unselectable = </span><span class="s2">&quot;on&quot;</span><span class="p">;</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span> <span class="s1">&#39;-moz-user-select&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span> <span class="s1">&#39;-webkit-user-select&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span>
<span class="p">}</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 